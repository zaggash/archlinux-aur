pkgname=docker-mcp-bin
pkgassetname=docker-mcp-linux-amd64.tar.gz
pkgver=0.21.0 # renovate: datasource=github-tags depName=docker/mcp-gateway extractVersion=v(?<version>.*) versioning=semver
pkgrel=1
pkgdesc='Docker MCP Gateway CLI Plugin'
arch=(x86_64)
url='https://github.com/docker/mcp-gateway'
license=(MIT)
provides=(docker-mcp-bin)
conflicts=(docker-mcp-bin)
options=('!strip')
source=("$url/releases/download/v$pkgver/$pkgassetname")

prepare() {
  curl -sL \
    -H "Accept: application/vnd.github+json" \
    -H "X-GitHub-Api-Version: 2022-11-28" \
    "https://api.github.com/repos/docker/mcp-gateway/releases/tags/v${pkgver}" |\
  jq --arg PKGASSETNAME "$pkgassetname" \
    -r '.assets[] | select(.name == $PKGASSETNAME) | .digest' |\
  cut -d ':' -f 2 | tr -d "\n" > $pkgname-sha256-$pkgver.txt

  echo -n " $pkgassetname" >> $pkgname-sha256-$pkgver.txt
	sha256sum -c $pkgname-sha256-$pkgver.txt
}

package() {
	install -Dm755 docker-mcp -t "$pkgdir/usr/lib/docker/cli-plugins/"
}
